<html>
<head>
    <meta name="viewport" content="width=device-width" />

    <title>Power Plan</title>
    <link rel="shortcut icon" type="image/x-icon" href="PowerPlan-logo.png" />

    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>

    <style>
        body {
            color: white;
            font-family: Raleway;
            font-weight: 600;
            text-shadow: #333 1.5px 1.5px 3px;
            text-align: center;
            background-image: url('coming-soon.jpeg');
            background-size: cover;
            background-position: center center;
        }

        div.content {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        p.title {
            font-size: 6vh;
            margin-bottom: 20vh;
        }

        p.intro {
            font-size: 3vw;
            margin-bottom: 10vh;
        }

        .email-group {
            margin-bottom: 4vh;
        }

        .email-group input[type=text] {
            height: 6vh;
            width: 34vw;
            font-size: 24px;
            text-align: center;
        }

        .email-group #errorMessage {
            color: red;
            font-size: 24px;
            text-shadow: 0px 0px 4px white;
            margin-top: 4px;
            visibility: hidden;
        }

        #result {
            font-size: 20px;
            font-weight: 800;
            height: 16vh;
            margin-bottom: 6vh;
        }

        button {
            height: 6vh;
            width: 24vw;
            margin-bottom: 8vh;
            background: #ff0081;
            border: 2px solid white;
            color: white;
            font-size: 3vh;
            font-weight: 400;
        }

        @media screen and (max-width: 1000px) {
            body {
                background-size: 1000px 100%;
            }

            p.title {
                font-size: 7vw;
                margin-bottom: 20vh;
            }

            p.intro {
                font-size: 5vw;
                margin-bottom: 12vh;
            }

            .email-group input[type=text] {
                width: 80vw;
                height: 40px;
                font-size: 16px;
            }

            .email-group #errorMessage {
                font-size: 18px;
            }

            #result {
                font-size: 17px;
                height: 14vh;
                margin: 0 8vw;
            }

            button {
                font-size: 22px;
                width: 60vw;
                height: 48px;
            }
        }
    </style>

    <script>
        $(document).ready(function () {
            //TODO: Initialization logic.
        });
    </script>
</head>

<body>
    <div class="content">
        <p class="title">Power Plan is Coming Soon</p>

        <p class="intro">
            Does you gym have a Power Plan?<br />
            Subscribe for further announcements.
        </p>

        <form onsubmit="return false;">
            <div class="email-group">
                <input name="email" type="text" placeholder="Provide your email here." onkeypress="email_changed()" />
                <div id="errorMessage">Please provide valid email.</div>
            </div>

            <p id="result" style="text-shadow: none; margin: 0 20vw">
                <button type="button" onclick="submit_click()">Subscribe</button>
            </p>
        </form>
    </div>

    <script>
        function getFormJson() {
            var formParams = $('form').serializeArray();
            var result = {};

            formParams.forEach(function (it) {
                result[it.name] = it.value;
            })

            return result;
        }

        function email_changed() {
            document.getElementById("errorMessage").style.visibility = "hidden";
        }

        function submit_click() {
            let apiUrl = "https://powerplan.azurewebsites.net/api/subscribe";
            //var formParams = getFormJson();
            //var requestUrl = apiUrl + "?email=" + formParams.email;

            var emailValue = document.getElementsByName("email")[0].value;
            var emailValue = emailValue.trim();
            if (!validateEmail(emailValue)) {
                document.getElementById("errorMessage").style.visibility = "visible";
                return;
            }

            //TODO: Implement work in progress animation.
            $('input').prop('disabled', true);
            $('button').css('visibility', 'hidden');

            var requestUrl = apiUrl + "?email=" + emailValue;
            var xhrRequest = {
                type: "POST",
                url: requestUrl,
                timeout: 5 * 60 * 1000
            }
            $.ajax(xhrRequest)
                .done(function () {
                    $('#result')
                        .css('color', 'green')
                        .text('You have been subscribed successfully.');
                })
                .fail(function (jqXHR) {
                    if (jqXHR.status === 409) {
                        $('#result')
                            .css('color', 'yellow')
                            .text('You are already subscribed.');
                    } else {
                        $('#result')
                            .css('color', 'red')
                            .text('An error has occurred. Please refresh page and try again.');
                    }
                })
        }

        function validateEmail(email) {
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }
    </script>
</body>
</html>